# Модуль `ui_connector` (Backend for Frontend - BFF)

## Назначение

Модуль `ui_connector` служит в качестве **Backend for Frontend (BFF)** слоя для UI-приложения. Его основная задача — предоставить единую, оптимизированную для фронтенда точку входа, агрегируя данные и бизнес-логику из различных внутренних сервисов. Это позволяет UI-приложению оставаться "тонким" клиентом, фокусируясь исключительно на отображении данных, в то время как вся сложная оркестрация и подготовка данных происходит на бэкенде.

## Ключевые преимущества

*   **Декаплинг (Decoupling):** UI взаимодействует только с `ui_connector`, не зная о внутренней структуре и множестве других бэкенд-модулей (MCP, LLM-интеграция и т.д.).
*   **Оптимизация для UI:** Эндпоинты и схемы данных `ui_connector` специально разработаны для нужд UI-компонентов, минимизируя необходимость в клиентской обработке данных.
*   **Снижение сетевого трафика:** Вместо множества запросов к разным сервисам, UI делает один запрос к `ui_connector`, который возвращает все необходимые данные.
*   **Повышенная безопасность:** Чувствительная логика и ключи API (например, для LLM) остаются на бэкенде, не попадая на клиентскую сторону.
*   **Централизация бизнес-логики:** Сложные вычисления и агрегация данных, которые ранее могли быть на фронтенде (например, рекомендации карт, расчеты "умного списания"), переносятся на сервер.

## Структура модуля

*   `router.py`: Определяет API-эндпоинты, доступные для UI. Каждый эндпоинт соответствует определенному UI-компоненту или странице.
*   `services.py`: Содержит основную бизнес-логику и оркестрацию. Методы этого сервиса вызывают другие внутренние сервисы (например, `MCPService`, `LLMAgentService`), агрегируют их ответы и выполняют необходимые вычисления.
*   `schemas.py`: Определяет Pydantic-схемы для запросов и ответов API, оптимизированные для потребления UI.
*   `dependencies.py`: Содержит функции для внедрения зависимостей, если это необходимо для специфических нужд `ui_connector`.

## Основные эндпоинты (примеры)

Все эндпоинты доступны по префиксу `/api/v1/ui`.

*   **`POST /api/v1/ui/dashboard`**
    *   **Назначение:** Получение всех агрегированных данных для главной страницы (Dashboard).
    *   **Входные данные:** `user_id`, `consent_id`.
    *   **Выходные данные:** `DashboardData` (общий капитал, счета, транзакции, цели, данные для графиков).

*   **`POST /api/v1/ui/assistant`**
    *   **Назначение:** Обработка запросов к финансовому AI-ассистенту.
    *   **Входные данные:** `user_id`, `consent_id`, `message` (текст запроса пользователя).
    *   **Выходные данные:** `AssistantResponse` (текстовый ответ от AI).

*   **`GET /api/v1/ui/cards`**
    *   **Назначение:** Получение данных для страницы "Карты", включая рекомендации по новым картам.
    *   **Входные данные:** `user_id`, `consent_id`.
    *   **Выходные данные:** `CardsPageData` (список карт, рекомендации).

*   **`POST /api/v1/ui/smart-debiting/calculate`**
    *   **Назначение:** Расчет оптимального плана списания средств для покупки.
    *   **Входные данные:** `user_id`, `consent_id`, `amount` (сумма покупки), `primary_account_id` (основной счет).
    *   **Выходные данные:** `SmartDebitingCalculation` (достаточно ли средств, план списания).

*(Этот список будет расширяться по мере реализации функционала для других UI-компонентов.)*
